'use strict'
function e(e) {
  return e && 'object' == typeof e && 'default' in e ? e.default : e
}
Object.defineProperty(exports, '__esModule', { value: !0 })
var t = e(require('react')),
  n = e(require('little-loader')),
  r = t.createContext({ isInProvider: !1, mapkit: void 0 }),
  i = function (e) {
    var i = e.tokenOrCallback,
      a = e.language,
      o = e.children,
      u = t.useContext(r),
      c = t.useState({ mapkit: u.mapkit, isInProvider: !0 }),
      p = c[0],
      l = c[1]
    return (
      t.useEffect(
        function () {
          u.isInProvider ||
            n('https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js', function () {
              var e = i.includes('/')
              mapkit.init({
                authorizationCallback: function (t) {
                  e
                    ? fetch(i)
                        .then(function (e) {
                          return e.text()
                        })
                        .then(t)
                    : t(i)
                },
                language: a,
              }),
                l({ mapkit: mapkit, isInProvider: !0 })
            })
        },
        [u.isInProvider, i, a],
      ),
      t.createElement(r.Provider, { value: p, children: o })
    )
  }
function a() {
  return (a =
    Object.assign ||
    function (e) {
      for (var t = 1; t < arguments.length; t++) {
        var n = arguments[t]
        for (var r in n)
          Object.prototype.hasOwnProperty.call(n, r) && (e[r] = n[r])
      }
      return e
    }).apply(this, arguments)
}
function o(e, t) {
  if (null == e) return {}
  var n,
    r,
    i = {},
    a = Object.keys(e)
  for (r = 0; r < a.length; r++) t.indexOf((n = a[r])) >= 0 || (i[n] = e[n])
  return i
}
var u = function (e) {
    return new mapkit.Padding(
      'number' == typeof e ? { top: e, right: e, bottom: e, left: e } : e,
    )
  },
  c = function (e, t) {
    return new mapkit.Coordinate(e, t)
  },
  p = function (e) {
    return l(
      c(e.latitude, e.longitude),
      new mapkit.CoordinateSpan(e.latitudeSpan, e.longitudeSpan),
    )
  },
  l = function (e, t) {
    return new mapkit.CoordinateRegion(e, t)
  },
  d = function (e, t, n, r) {
    return new mapkit.MapRect(e, t, n, r)
  },
  f = function (e) {
    var t = e.padding,
      n = o(e, ['padding'])
    return a({ padding: u(t || 0) }, n)
  },
  s = function (e) {
    void 0 === e && (e = {})
    var n = t.useState(e)[0],
      i = t.useContext(r).mapkit,
      l = t.useRef(null),
      f = t.useState(),
      s = f[0],
      m = f[1]
    return (
      t.useEffect(
        function () {
          if (i && l.current) {
            var e = new i.Map(
              l.current,
              ((r = (t = n).visibleMapRect),
              (f = t.region),
              (s = t.center),
              (v = t.padding),
              (k = o(t, ['visibleMapRect', 'region', 'center', 'padding'])),
              a(
                {
                  visibleMapRect: r && d.apply(void 0, r),
                  region: f && p(f),
                  center: s && c.apply(void 0, s),
                  padding: u(v || 0),
                },
                k,
              )),
            )
            m(e)
          }
          var t, r, f, s, v, k
        },
        [l, i],
      ),
      t.useEffect(function () {
        return function () {
          s && s.destroy()
        }
      }, []),
      {
        mapkit: i,
        map: s,
        mapProps: { mapkit: i, map: s, mapRef: l },
        setRotation: t.useCallback(
          function (e, t) {
            void 0 === t && (t = !1), s && s.setRotationAnimated(e, t)
          },
          [s],
        ),
        setCenter: t.useCallback(
          function (e, t) {
            void 0 === t && (t = !1),
              s && s.setCenterAnimated(c.apply(void 0, e), t)
          },
          [s],
        ),
        setRegion: t.useCallback(
          function (e, t) {
            void 0 === t && (t = !1), s && s.setRegionAnimated(p(e), t)
          },
          [s],
        ),
        setVisibleMapRect: t.useCallback(
          function (e, t) {
            void 0 === t && (t = !1),
              s && s.setVisibleMapRectAnimated(d.apply(void 0, e), t)
          },
          [s],
        ),
      }
    )
  },
  m = t.createContext({ map: void 0, mapkit: void 0 }),
  v = function (e) {
    return t.createElement(m.Provider, {
      value: e.context,
      children: e.children,
    })
  },
  k = function (e) {
    return t.createElement('div', {
      ref: e.mapRef,
      style: { width: '100%', height: '100%' },
      children: e.children,
    })
  },
  g = function (e) {
    var n = e.children,
      r = o(e, ['children']),
      i = s(r).mapProps
    return t.createElement(
      v,
      { context: { mapkit: i.mapkit, map: i.map } },
      t.createElement(k, { mapRef: i.mapRef, children: n }),
    )
  }
;(exports.Annotation = function (e) {
  var n = e.latitude,
    r = e.longitude,
    i = e.factory,
    a = o(e, ['latitude', 'longitude', 'factory']),
    u = t.useContext(m),
    p = u.mapkit,
    l = u.map,
    d = t.useRef()
  return (
    t.useEffect(
      function () {
        p &&
          l &&
          ((d.current = new p.Annotation(c(n, r), i, f(a))),
          l.addAnnotation(d.current))
      },
      [p, l, n, r, i, a],
    ),
    null
  )
}),
  (exports.Map = function (e) {
    var n = e.tokenOrCallback,
      a = e.language,
      u = void 0 === a ? 'en' : a,
      c = e.mapkit,
      p = e.map,
      l = e.mapRef,
      d = o(e, ['tokenOrCallback', 'language', 'mapkit', 'map', 'mapRef']),
      f = t.useContext(r)
    if (l)
      return t.createElement(
        v,
        { context: { mapkit: c, map: p } },
        t.createElement(k, Object.assign({ mapRef: l }, d)),
      )
    var s = t.createElement(g, Object.assign({}, d))
    if (f.isInProvider) return s
    if (!n)
      throw new Error(
        '`tokenOrCallback` is required. Either add it to this `Map` component or to a `MapkitProvider` parent of this component.',
      )
    return t.createElement(i, { tokenOrCallback: n, language: u, children: s })
  }),
  (exports.MapContext = m),
  (exports.MapkitContext = r),
  (exports.MapkitProvider = i),
  (exports.Marker = function (e) {
    var n = e.latitude,
      r = e.longitude,
      i = o(e, ['latitude', 'longitude']),
      a = t.useContext(m),
      u = a.mapkit,
      p = a.map,
      l = t.useRef()
    return (
      t.useEffect(
        function () {
          return (
            u &&
              p &&
              ((l.current = new u.MarkerAnnotation(c(n, r), f(i))),
              p.addAnnotation(l.current)),
            function () {
              l.current && p && p.removeAnnotation(l.current)
            }
          )
        },
        [u, p],
      ),
      null
    )
  }),
  (exports.useMap = s)
//# sourceMappingURL=react-mapkit.cjs.production.min.js.map
