{"version":3,"file":"react-mapkit.esm.js","sources":["../src/MapkitProvider.tsx","../src/utils.ts","../src/useMap.tsx","../src/Map.tsx","../src/Marker.tsx","../src/Annotation.tsx"],"sourcesContent":["/* global mapkit */\n\nimport React from 'react'\nimport load from 'little-loader'\n\ntype MapkitContextType = {\n  isInProvider: boolean\n  mapkit: typeof mapkit | undefined\n}\n\nexport const MapkitContext = React.createContext<MapkitContextType>({\n  isInProvider: false,\n  mapkit: undefined,\n})\n\ntype ProviderProps = {\n  // ‚ö†Ô∏è Pick between callbackUrl or token.\n  // https://developer.apple.com/documentation/mapkitjs/mapkit/2974045-init\n  tokenOrCallback: string\n  language?: string\n}\n\nexport const MapkitProvider: React.FC<ProviderProps> = ({\n  tokenOrCallback,\n  language,\n  children,\n}) => {\n  const existingContext = React.useContext(MapkitContext)\n\n  const [context, setContext] = React.useState<MapkitContextType>({\n    mapkit: existingContext.mapkit,\n    isInProvider: true,\n  })\n\n  React.useEffect(() => {\n    if (!existingContext.isInProvider) {\n      load('https://cdn.apple-mapkit.com/mk/5.x.x/mapkit.js', () => {\n        const isCallback = tokenOrCallback.includes('/')\n\n        // init mapkit\n        mapkit.init({\n          authorizationCallback: (done) => {\n            if (isCallback) {\n              fetch(tokenOrCallback)\n                .then((res) => res.text())\n                .then(done)\n            } else {\n              done(tokenOrCallback)\n            }\n          },\n          language,\n        })\n        setContext({ mapkit, isInProvider: true })\n      })\n    }\n  }, [existingContext.isInProvider, tokenOrCallback, language])\n\n  return <MapkitContext.Provider value={context} children={children} />\n}\n","/* global mapkit */\n\n// Typescript Helpers\ntype Merge<M, N> = Omit<M, Extract<keyof M, keyof N>> & N\ntype ConstructorParameters<T> = T extends new (...args: infer U) => any\n  ? U\n  : never\n\ntype MapConstructionOptions = NonNullable<\n  ConstructorParameters<typeof mapkit.Map>[1]\n>\n\ntype AnnotationConstructionOptions = NonNullable<\n  ConstructorParameters<typeof mapkit.Annotation>[1]\n>\n\ntype MarkerConstructionOptions = NonNullable<\n  ConstructorParameters<typeof mapkit.MarkerAnnotation>[1]\n>\n\ntype PaddingConstructorOptions = NonNullable<\n  ConstructorParameters<typeof mapkit.Padding>[0]\n>\n\nexport type NumberTuple = [number, number]\nexport type Rect = [number, number, number, number]\nexport type PaddingType = number | PaddingConstructorOptions\nexport type RegionType = {\n  latitude: number\n  longitude: number\n  latitudeSpan: number\n  longitudeSpan: number\n}\nexport type ImageUrl = {\n  '1': string\n  '2'?: string\n  '3'?: string\n}\n\n// Mapkit helpers\n\nexport const createPadding = (padding: PaddingType) => {\n  return new mapkit.Padding(\n    typeof padding === 'number'\n      ? {\n          top: padding,\n          right: padding,\n          bottom: padding,\n          left: padding,\n        }\n      : padding,\n  )\n}\n\nexport const createCoordinate = (latitude: number, longitude: number) => {\n  return new mapkit.Coordinate(latitude, longitude)\n}\n\nexport const createCoordinateSpan = (\n  latitudeDelta: number,\n  longitudeDelta: number,\n) => {\n  return new mapkit.CoordinateSpan(latitudeDelta, longitudeDelta)\n}\n\nexport const createCoordinateRegionFromValues = (region: RegionType) => {\n  return createCoordinateRegion(\n    createCoordinate(region.latitude, region.longitude),\n    createCoordinateSpan(region.latitudeSpan, region.longitudeSpan),\n  )\n}\n\nexport const createCoordinateRegion = (\n  center: mapkit.Coordinate,\n  span: mapkit.CoordinateSpan,\n) => {\n  return new mapkit.CoordinateRegion(center, span)\n}\n\nexport const createMapPoint = (x: number, y: number) => {\n  return new mapkit.MapPoint(x, y)\n}\n\nexport const createMapRect = (\n  x: number,\n  y: number,\n  width: number,\n  height: number,\n) => {\n  return new mapkit.MapRect(x, y, width, height)\n}\n\n// üó∫Ô∏è Map Options\n\n// these are the props we expose to users.\nexport type MapOptions = Merge<\n  MapConstructionOptions,\n  {\n    visibleMapRect?: Rect\n    region?: RegionType\n    center?: NumberTuple\n    padding?: PaddingType\n  }\n>\n\n// this function takes simple props and turns them into the mapkit options that mapkit expects\nexport const propsToMapConstructionOptions = ({\n  visibleMapRect,\n  region,\n  center,\n  padding,\n  ...options\n}: MapOptions) => ({\n  visibleMapRect: visibleMapRect && createMapRect(...visibleMapRect),\n  region: region && createCoordinateRegionFromValues(region),\n  center: center && createCoordinate(...center),\n  padding: padding ? createPadding(padding) : createPadding(0),\n  ...options,\n})\n\n// üìå Marker Options\n\n// these are the props we expose to users.\nexport type AnnotationOptions = Merge<\n  AnnotationConstructionOptions,\n  {\n    padding?: PaddingType\n  }\n>\n\nexport type MarkerOptions = Merge<\n  MarkerConstructionOptions,\n  {\n    padding?: PaddingType\n  }\n>\n\nexport const propsToMarkerConstructionOptions = ({\n  padding,\n  ...options\n}: MarkerOptions) => {\n  return {\n    padding: padding ? createPadding(padding) : createPadding(0),\n    ...options,\n  }\n}\n","import React from 'react'\n\nimport { MapkitContext } from './MapkitProvider'\nimport { MapOptions, propsToMapConstructionOptions } from './utils'\n\nimport {\n  NumberTuple,\n  Rect,\n  RegionType,\n  createCoordinate,\n  createMapRect,\n  createCoordinateRegionFromValues,\n} from './utils'\n\nexport const useMap = (defaultOptions: MapOptions = {}) => {\n  const [defaultMapOptions] = React.useState(defaultOptions)\n  let { mapkit } = React.useContext(MapkitContext)\n  let mapRef = React.useRef<HTMLDivElement>(null)\n  let [map, setMap] = React.useState<mapkit.Map>()\n\n  React.useEffect(() => {\n    if (mapkit && mapRef.current) {\n      const newMap = new mapkit.Map(\n        mapRef.current,\n        propsToMapConstructionOptions(defaultMapOptions),\n      )\n      setMap(newMap)\n    }\n  }, [mapRef, mapkit])\n\n  // Clean up the map on unmount\n  React.useEffect(() => {\n    return () => {\n      if (map) {\n        map.destroy()\n      }\n    }\n  }, [])\n\n  return {\n    mapkit,\n    map,\n    mapProps: {\n      mapkit,\n      map,\n      mapRef,\n    },\n    setRotation: React.useCallback(\n      (rotationValue: number, isAnimated: boolean = false) => {\n        if (map) {\n          map.setRotationAnimated(rotationValue, isAnimated)\n        }\n      },\n      [map],\n    ),\n    setCenter: React.useCallback(\n      (centerValue: NumberTuple, isAnimated: boolean = false) => {\n        if (map) {\n          map.setCenterAnimated(createCoordinate(...centerValue), isAnimated)\n        }\n      },\n      [map],\n    ),\n    setRegion: React.useCallback(\n      (region: RegionType, isAnimated: boolean = false) => {\n        if (map) {\n          map.setRegionAnimated(\n            createCoordinateRegionFromValues(region),\n            isAnimated,\n          )\n        }\n      },\n      [map],\n    ),\n    setVisibleMapRect: React.useCallback(\n      (visibleMapRect: Rect, isAnimated: boolean = false) => {\n        if (map) {\n          map.setVisibleMapRectAnimated(\n            createMapRect(...visibleMapRect),\n            isAnimated,\n          )\n        }\n      },\n      [map],\n    ),\n  }\n}\n","/* global mapkit */\n\nimport React from 'react'\n\nimport { MapkitContext, MapkitProvider } from './MapkitProvider'\nimport { useMap } from './useMap'\nimport { MapOptions } from './utils'\n\ntype MapRef = React.RefObject<HTMLDivElement>\n\ntype MapContextType = {\n  map?: mapkit.Map\n  mapkit?: typeof mapkit\n}\n\nexport const MapContext = React.createContext<MapContextType>({\n  map: undefined,\n  mapkit: undefined,\n})\n\nconst MapProvider: React.FC<{ context: MapContextType }> = ({\n  children,\n  context,\n}) => {\n  return <MapContext.Provider value={context} children={children} />\n}\n\n// this component is the parent to the mapkit generated map components\nconst MapContainer: React.FC<{ mapRef: MapRef }> = ({ children, mapRef }) => {\n  return (\n    <div\n      ref={mapRef}\n      style={{ width: '100%', height: '100%' }}\n      children={children}\n    />\n  )\n}\n\nconst CreateMap: React.FC<MapOptions> = ({ children, ...defaultOptions }) => {\n  const {\n    mapProps: { mapkit, map, mapRef },\n  } = useMap(defaultOptions)\n\n  return (\n    <MapProvider context={{ mapkit, map }}>\n      <MapContainer mapRef={mapRef} children={children} />\n    </MapProvider>\n  )\n}\n\nexport const Map: React.FC<\n  {\n    // ‚ö†Ô∏è Pick between callbackUrl or token.\n    // https://developer.apple.com/documentation/mapkitjs/mapkit/2974045-init\n    // not needed if within a `MapProvider`\n    tokenOrCallback?: string\n    language?: string\n    mapRef?: MapRef\n    mapkit?: typeof mapkit\n    map?: mapkit.Map\n  } & MapOptions\n> = ({ tokenOrCallback, language = 'en', mapkit, map, mapRef, ...props }) => {\n  let context = React.useContext(MapkitContext)\n\n  // map has already been created, we just need to setup the provider\n  if (mapRef) {\n    return (\n      <MapProvider context={{ mapkit, map }}>\n        <MapContainer mapRef={mapRef} {...props} />\n      </MapProvider>\n    )\n  }\n\n  // map hasn't yet been created, lets create it!\n  const mapBox = <CreateMap {...props} />\n\n  // we are in a provider, just return the map\n  if (context.isInProvider) {\n    return mapBox\n  }\n\n  // No Provider setup provider around map\n  if (!tokenOrCallback) {\n    throw new Error(\n      '`tokenOrCallback` is required. Either add it to this `Map` component or to a `MapkitProvider` parent of this component.',\n    )\n  }\n\n  return (\n    <MapkitProvider\n      tokenOrCallback={tokenOrCallback}\n      language={language}\n      children={mapBox}\n    />\n  )\n}\n","import React from 'react'\n\nimport { MapContext } from './Map'\n\nimport {\n  MarkerOptions,\n  createCoordinate,\n  propsToMarkerConstructionOptions,\n} from './utils'\n\ntype MarkerProps = {\n  latitude: number\n  longitude: number\n} & MarkerOptions\n\nexport const Marker: React.FC<MarkerProps> = ({\n  latitude,\n  longitude,\n  ...options\n}) => {\n  const { mapkit, map } = React.useContext(MapContext)\n  const marker = React.useRef<mapkit.MarkerAnnotation>()\n\n  React.useEffect(() => {\n    if (mapkit && map) {\n      marker.current = new mapkit.MarkerAnnotation(\n        createCoordinate(latitude, longitude),\n        propsToMarkerConstructionOptions(options),\n      )\n\n      map.addAnnotation(marker.current)\n    }\n    return () => {\n      marker.current && map && map.removeAnnotation(marker.current)\n    }\n  }, [mapkit, map])\n\n  return null\n}\n","import React from 'react'\n\nimport { MapContext } from './Map'\n\nimport {\n  createCoordinate,\n  propsToMarkerConstructionOptions,\n  AnnotationOptions,\n} from './utils'\n\ntype AnnotationProps = {\n  latitude: number\n  longitude: number\n  factory: (\n    coordinate: mapkit.Coordinate,\n    options: mapkit.AnnotationConstructorOptions,\n  ) => Element\n} & AnnotationOptions\n\nexport const Annotation: React.FC<AnnotationProps> = ({\n  latitude,\n  longitude,\n  factory,\n  ...options\n}) => {\n  const { mapkit, map } = React.useContext(MapContext)\n  const annotation = React.useRef<mapkit.Annotation>()\n\n  React.useEffect(() => {\n    if (mapkit && map) {\n      annotation.current = new mapkit.Annotation(\n        createCoordinate(latitude, longitude),\n        factory,\n        propsToMarkerConstructionOptions(options),\n      )\n\n      map.addAnnotation(annotation.current)\n    }\n    return () => {\n      annotation.current && map && map.removeAnnotation(annotation.current)\n    }\n  }, [mapkit, map])\n\n  return null\n}\n"],"names":["MapkitContext","React","createContext","isInProvider","mapkit","undefined","MapkitProvider","tokenOrCallback","language","children","existingContext","useContext","useState","context","setContext","useEffect","load","isCallback","includes","init","authorizationCallback","done","fetch","then","res","text","Provider","value","createPadding","padding","Padding","top","right","bottom","left","createCoordinate","latitude","longitude","Coordinate","createCoordinateSpan","latitudeDelta","longitudeDelta","CoordinateSpan","createCoordinateRegionFromValues","region","createCoordinateRegion","latitudeSpan","longitudeSpan","center","span","CoordinateRegion","createMapRect","x","y","width","height","MapRect","propsToMapConstructionOptions","visibleMapRect","options","propsToMarkerConstructionOptions","useMap","defaultOptions","defaultMapOptions","mapRef","useRef","map","setMap","current","newMap","Map","destroy","mapProps","setRotation","useCallback","rotationValue","isAnimated","setRotationAnimated","setCenter","centerValue","setCenterAnimated","setRegion","setRegionAnimated","setVisibleMapRect","setVisibleMapRectAnimated","MapContext","MapProvider","MapContainer","ref","style","CreateMap","props","mapBox","Error","Marker","marker","MarkerAnnotation","addAnnotation","removeAnnotation","Annotation","factory","annotation"],"mappings":"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"}